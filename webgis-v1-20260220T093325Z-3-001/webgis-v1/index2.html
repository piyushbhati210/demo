<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Level 2 Cloud Web GIS</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

  <!-- Marker Cluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>

  <style>
    body { margin: 0; font-family: Arial; }
    #map { height: 90vh; }
    #panel {
      padding: 10px;
      background: #f4f4f4;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    input {
      padding: 5px;
    }
  </style>
</head>

<body>

<div id="panel">
  <div>
    <strong>Total Features:</strong> <span id="count">0</span>
  </div>
  <div>
    <input type="text" id="searchBox" placeholder="Search city name..." />
    <button onclick="filterData()">Search</button>
    <button onclick="resetData()">Reset</button>
  </div>
</div>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Marker Cluster JS -->
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
  var map = L.map('map').setView([20.5937, 78.9629], 5);

  var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  var markers = L.markerClusterGroup();
  var geojsonLayer;
  var geojsonData;

  fetch('data.geojson')
    .then(response => response.json())
    .then(data => {
      geojsonData = data;
      loadLayer(data);
    })
    .catch(error => console.error("Error loading GeoJSON:", error));

  function loadLayer(data) {
    markers.clearLayers();

    geojsonLayer = L.geoJSON(data, {
      onEachFeature: function(feature, layer) {
        layer.bindPopup("<b>" + feature.properties.name + "</b>");
      }
    });

    markers.addLayer(geojsonLayer);
    map.addLayer(markers);

    document.getElementById("count").innerText = data.features.length;
  }

  function filterData() {
    var searchValue = document.getElementById("searchBox").value.toLowerCase();

    var filtered = {
      "type": "FeatureCollection",
      "features": geojsonData.features.filter(f =>
        f.properties.name.toLowerCase().includes(searchValue)
      )
    };

    loadLayer(filtered);
  }

  function resetData() {
    document.getElementById("searchBox").value = "";
    loadLayer(geojsonData);
  }

  var baseMaps = {
    "OpenStreetMap": osm
  };

  L.control.layers(baseMaps).addTo(map);

</script>

</body>
</html>
